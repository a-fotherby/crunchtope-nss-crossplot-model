path1 = getenv('PATH');
path1 = [path1 ':/usr/local/bin'];
setenv('PATH', path1);

t = tiledlayout(2, 2, 'TileSpacing', 'compact', 'Padding', 'compact');
oldFolder = pwd;
cd('~/Dropbox/Academic/Isotope Model/crunchModel/')

xlabel(t, 'Time (yrs)');
ylabel(t, 'SALP');

for caseNum = 1
    nexttile()
    runCommand = sprintf('~/soft/crunchtope/CrunchTope case%d.in', caseNum);
    system(runCommand)
    if caseNum == 3 || caseNum == 4
        restartCommand = sprintf('~/soft/crunchtope/CrunchTope case%dRestart.in', caseNum);
        system(restartCommand)
    end
    !~/.scripts/cleanCrunchOutput.sh
    [SALP, time] = gradientTimeDepInterp('toperatio_aq', 'SO4--', 'SO164--', 16);
    [concGrad, time] = gradientTimeDepInterp('totcon', 'SO4--', 'Distance', 0.01);
    [ScompGrad, time] = gradientTimeDepInterp('toperatio_aq', 'SO4--', 'Distance', 0.01);
    [OcompGrad, time] = gradientTimeDepInterp('toperatio_aq', 'SO164--', 'Distance', 0.01);

    pTimeToSS = time ./ time(end) * 100;
    ppSALP = (SALP ./ SALP(end) * 100;
    ppScomp = (ScompGrad ./ ScompGrad(end) * 100;
    ppOcomp = (OcompGrad ./ OcompGrad(end) * 100;
    
    figure
    hold on
    
    plot(pTimeToSS, ppSALP, 'DisplayName', 'SALP');
    %plot(pTimeToSS, concGrad, 'DisplayName', 'Concentration');
    plot(pTimeToSS, ScompGrad, 'DisplayName', 'Sulfur composition');
    plot(pTimeToSS, OcompGrad, 'DisplayName', 'Oxygen composition');
    
    xlabel('Percentage progress to steady state (%)')
    ylabel('ln(gradient)')
    legend
end

set(findall(gcf,'-property','FontSize'),'FontSize',12)

exportgraphics(t, '/Users/angus/Dropbox/Academic/Isotope Model/Writeup/Figures/SALPofTime.eps', 'ContentType', 'vector');

cd(oldFolder)